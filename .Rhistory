rep(0, n_assets)     # The values for the w_i >= 0 constraints
)
meq <- 1
sol<- solve.QP(Dmat = Dmat,
dvec = dvec,
Amat = Amat,
bvec = bvec,
meq = meq)
w <- sol$solution/sum(sol$solution)
return(w)
}
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
n <- nrow(size_mom_6_monthly)-35
w_matrix <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35), -1]
rf_period <- RF.US$RF[i:(i+35)]
w_matrix[i,] <- optimize_portfolio(returns_period, rf_period)
}
w_df <- as_tibble(w_matrix)
names(w_df) <- names(size_mom_6_monthly[, -1])
round(w_df, 3)
optimize_portfolio <- function(returns, rf){
mu <- colMeans(returns) - mean(rf)
n_assets <- length(mu)
Dmat <- cov(returns)
dvec <- rep(0, n_assets)
Amat <- cbind(mu, diag(n_assets))
bvec <- c(
1,                   # The value for the first constraint (sum(...) = 1)
rep(0, n_assets)     # The values for the w_i >= 0 constraints
)
meq <- 1
sol<- solve.QP(Dmat = Dmat,
dvec = dvec,
Amat = Amat,
bvec = bvec,
meq = meq)
w <- sol$solution/sum(sol$solution)
return(w)
}
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
n <- nrow(size_mom_6_monthly)-35
w_matrix <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35), -1]
rf_period <- RF.US$RF[i:(i+35)]
w_matrix[i,] <- optimize_portfolio(returns_period, rf_period)
}
optimize_portfolio2 <- function(mu, cov_period){
mu <- colMeans(returns) - mean(rf)
n_assets <- length(mu)
Dmat <- cov_period
dvec <- rep(0, n_assets)
Amat <- cbind(mu, diag(n_assets))
bvec <- c(
1,                   # The value for the first constraint (sum(...) = 1)
rep(0, n_assets)     # The values for the w_i >= 0 constraints
)
meq <- 1
sol<- solve.QP(Dmat = Dmat,
dvec = dvec,
Amat = Amat,
bvec = bvec,
meq = meq)
w <- sol$solution/sum(sol$solution)
return(w)
}
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35), -1]
rf_period <- RF.US$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
w_matrix[i,] <- optimize_portfolio2(mu, cov_period)
}
optimize_portfolio2 <- function(mu, cov_period){
n_assets <- length(mu)
Dmat <- cov_period
dvec <- rep(0, n_assets)
Amat <- cbind(mu, diag(n_assets))
bvec <- c(
1,                   # The value for the first constraint (sum(...) = 1)
rep(0, n_assets)     # The values for the w_i >= 0 constraints
)
meq <- 1
sol<- solve.QP(Dmat = Dmat,
dvec = dvec,
Amat = Amat,
bvec = bvec,
meq = meq)
w <- sol$solution/sum(sol$solution)
return(w)
}
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35), -1]
rf_period <- RF.US$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
w_matrix[i,] <- optimize_portfolio2(mu, cov_period)
}
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35), -1]
rf_period <- RF.US$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix[i,] <- 0
} else{
w_matrix[i,] <- optimize_portfolio2(mu, cov_period)
}
}
w_df <- as_tibble(w_matrix)
names(w_df) <- names(size_mom_6_monthly[, -1])
round(w_df, 3)
sum(rowSums(w_df) == 0)
optimize_portfolio <- function(mu, cov_period){
n_assets <- length(mu)
Dmat <- cov_period
dvec <- rep(0, n_assets)
Amat <- cbind(mu, diag(n_assets))
bvec <- c(
1,                   # The value for the first constraint (sum(...) = 1)
rep(0, n_assets)     # The values for the w_i >= 0 constraints
)
meq <- 1
sol<- solve.QP(Dmat = Dmat,
dvec = dvec,
Amat = Amat,
bvec = bvec,
meq = meq)
w <- sol$solution/sum(sol$solution)
return(w)
}
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
n <- nrow(size_mom_6_monthly)-35
w_matrix <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35), -1]
rf_period <- RF.US$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix[i,] <- 0
} else{
w_matrix[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df <- as_tibble(w_matrix)
names(w_df) <- names(size_mom_6_monthly[, -1])
round(w_df, 3)
optimize_portfolio <- function(excess_returns, cov_period){
n_assets <- length(excess_returns)
Dmat <- cov_period
dvec <- rep(0, n_assets)
Amat <- cbind(excess_returns, diag(n_assets))
bvec <- c(
1,                   # The value for the first constraint (sum(...) = 1)
rep(0, n_assets)     # The values for the w_i >= 0 constraints
)
meq <- 1
sol<- solve.QP(Dmat = Dmat,
dvec = dvec,
Amat = Amat,
bvec = bvec,
meq = meq)
w <- sol$solution/sum(sol$solution)
return(w)
}
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
n <- nrow(size_mom_6_monthly)-35
w_matrix <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35), -1]
rf_period <- RF.US$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix[i,] <- 0
} else{
w_matrix[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df <- as_tibble(w_matrix)
names(w_df) <- names(size_mom_6_monthly[, -1])
round(w_df, 3)
exchange_rate
exchange_rate %>% filter(date >= Date(2004-09-01))
Date(2004-09-01)
exchange_rate %>% filter(date >= as.Date("2004-09-01"))
as.Date("2004-09-01")
exchange_rate
exchange_rate %>% filter(date >= "2004-09-01")
exchange_rate
exchange_rate %>% filter(date >= as.Date("2004-09-01"))
exchange_rate
exchange_rate %>% filter(Date >= as.Date("2004-09-01"))
select(exchange_rate %>% filter(Date >= as.Date("2004-09-01")), c("Date, USD"))
select(exchange_rate %>% filter(Date >= as.Date("2004-09-01")), c("Date", "USD"))
Exchange_rate_US <- select(exchange_rate %>% filter(Date >= as.Date("2004-09-01")), c("Date", "USD"))
Exchange_rate_US <- Exchange_rate_US[nrow(Exchange_rate_US):1,]
Exchange_rate_US
Exchange_rate_US %>%
mutate(Date = floor_date(date, " month")) %>%
group_by(Date) %>%
summarise(USD = mean(USD))
Exchange_rate_US %>%
mutate(Date = floor_date(date, " month"))
Exchange_rate_US %>%
mutate(Date = floor_date(Date, " month")) %>%
group_by(Date) %>%
summarise(USD = mean(USD))
RF.US
size_mom_6_monthly
Exchange_rate_US <- select(exchange_rate %>% filter(Date >= as.Date("2004-09-01") & Date <= as.Date(2025-08-31)), c("Date", "USD"))
Exchange_rate_US
Exchange_rate_US <- select(exchange_rate %>% filter(Date >= as.Date("2004-09-01") & Date <= as.Date(2025-08-31)), c("Date", "USD"))
Exchange_rate_US
Exchange_rate_US <- select(exchange_rate %>% filter(Date >= as.Date("2004-09-01"), Date <= as.Date(2025-08-31)), c("Date", "USD"))
Exchange_rate_US
select(exchange_rate %>% filter(Date >= as.Date("2004-09-01"), Date <= as.Date(2025-08-31)), c("Date", "USD"))
(exchange_rate %>% filter(Date >= as.Date("2004-09-01"), Date <= as.Date(2025-08-31))
(exchange_rate %>% filter(Date >= as.Date("2004-09-01"), Date <= as.Date(2025-08-31))
(exchange_rate %>% filter(Date >= as.Date("2004-09-01"), Date <= as.Date(2025-08-31))
(exchange_rate %>% filter(Date >= as.Date("2004-09-01"), Date <= as.Date(2025-08-31)
(exchange_rate %>% filter(Date >= as.Date("2004-09-01"), Date <= as.Date(2025-08-31)
(exchange_rate %>% filter(Date >= as.Date("2004-09-01"), Date <= as.Date(2025-08-31
(exchange_rate %>% filter(Date >= as.Date("2004-09-01"), Date <= as.Date(2025-08-31
Exchange_rate_US <- exchange_rate %>% filter(Date >= "2004-09-01" & Date <= "2025-08-31")
Exchange_rate_US <- exchange_rate %>% filter(Date >= "2004-09-01", Date <= "2025-08-31")
Exchange_rate_US
Exchange_rate_US <- exchange_rate %>%
filter(Date >= "2004-09-01", Date <= "2025-08-31") %>%
select(c("Date", "USD"))
Exchange_rate_US
Exchange_rate_US <- Exchange_rate_US[nrow(Exchange_rate_US):1,]
Exchange_rate_US %>%
mutate(Date = floor_date(Date, " month")) %>%
group_by(Date) %>%
summarise(USD = mean(USD))
Exchange_rate_US <- Exchange_rate_US %>%
mutate(Date = floor_date(Date, " month")) %>%
group_by(Date) %>%
summarise(USD = mean(USD))
Exchange_rate_US
size_mom_6_monthly
RF.EU <- RF.US # skal ændres til EU
sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US, "/")
Exchange_rate_US
sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
size_mom_6_monthly[,-1]
sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
returns_EU <- sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
returns_EUR <- sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
returns_EUR
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
size_mom_6_monthly
RF.EU <- RF.US # skal ændres til EU
returns_EUR <- sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
n <- nrow(returns_EUR)-35
w_matrix_2 <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- returns_EUR[i:(i+35),]
rf_period <- RF.EU$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix2[i,] <- 0
} else{
w_matrix2[i,] <- optimize_portfolio(mu, cov_period)
}
}
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
size_mom_6_monthly
RF.EU <- RF.US # skal ændres til EU
returns_EUR <- sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
n <- nrow(returns_EUR)-35
w_matrix2 <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- returns_EUR[i:(i+35),]
rf_period <- RF.EU$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix2[i,] <- 0
} else{
w_matrix2[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df2 <- as_tibble(w_matrix2)
names(w_df) <- names(returns_EUR[, -1])
round(w_df, 3)
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
size_mom_6_monthly
RF.EU <- RF.US # skal ændres til EU
returns_EUR <- sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
n <- nrow(returns_EUR)-35
w_matrix2 <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- returns_EUR[i:(i+35),]
rf_period <- RF.EU$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix2[i,] <- 0
} else{
w_matrix2[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df2 <- as_tibble(w_matrix2)
names(w_df2) <- names(returns_EUR[, -1])
round(w_df2, 3)
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
RF.EU <- RF.US # skal ændres til EU
returns_EUR <- sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
n <- nrow(returns_EUR)-35
w_matrix2 <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- returns_EUR[i:(i+35),]
rf_period <- RF.EU$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix2[i,] <- 0
} else{
w_matrix2[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df2 <- as_tibble(w_matrix2)
names(w_df2) <- names(returns_EUR[, -1])
round(w_df2, 3)
size_mom_6_euro$subsets
size_mom_6_monthly <- size_mom_6_euro$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
RF.EU <- RF.US # skal ændres til EU
n <- nrow(size_mom_6_monthly)-35
w_matrix3 <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35),-1]
rf_period <- RF.EU$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix3[i,] <- 0
} else{
w_matrix3[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df3 <- as_tibble(w_matrix3)
names(w_df3) <- names(size_mom_6_monthly[, -1])
round(w_df3, 3)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(frenchdata)
library(ggplot2)
library(quadprog)
data_sets = get_french_data_list() # All the datasets in the package
# US stocks
# Nr 1 er månedlige returns
# Nr 2 er årlige returns
ff_3_factors <- download_french_data("Fama/French 3 Factors") # Download of data
# f_3_factors$subsets$data[[2]] # How to extract dataset
# browse_details_page(ff_3_factors) # Details of the dataset
size_mom_6 <- download_french_data("6 Portfolios Formed on Size and Momentum (2 x 3)")
size_mom_25 <- download_french_data("25 Portfolios Formed on Size and Momentum (5 x 5)")
# EU stocks in US dollars
size_mom_6_euro <- download_french_data("6 European Portfolios Formed on Size and Momentum (2 x 3)")
size_mom_25_euro <- download_french_data("25 European Portfolios Formed on Size and Momentum (5 x 5)")
# Other
exchange_rate <- read_csv("Data AA/eurofxref-hist.csv")
Exchange_rate_US <- exchange_rate %>%
filter(Date >= "2004-09-01", Date <= "2025-08-31") %>%
select(c("Date", "USD"))
Exchange_rate_US <- Exchange_rate_US[nrow(Exchange_rate_US):1,]
Exchange_rate_US <- Exchange_rate_US %>%
mutate(Date = floor_date(Date, " month")) %>%
group_by(Date) %>%
summarise(USD = mean(USD))
optimize_portfolio <- function(excess_returns, cov_period){
n_assets <- length(excess_returns)
Dmat <- cov_period
dvec <- rep(0, n_assets)
Amat <- cbind(excess_returns, diag(n_assets))
bvec <- c(
1,                   # The value for the first constraint (sum(...) = 1)
rep(0, n_assets)     # The values for the w_i >= 0 constraints
)
meq <- 1
sol<- solve.QP(Dmat = Dmat,
dvec = dvec,
Amat = Amat,
bvec = bvec,
meq = meq)
w <- sol$solution/sum(sol$solution)
return(w)
}
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
n <- nrow(size_mom_6_monthly)-35
w_matrix <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35), -1]
rf_period <- RF.US$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix[i,] <- 0
} else{
w_matrix[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df <- as_tibble(w_matrix)
names(w_df) <- names(size_mom_6_monthly[, -1])
round(w_df, 3)
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
RF.EU <- RF.US # skal ændres til EU
returns_EUR <- sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
n <- nrow(returns_EUR)-35
w_matrix2 <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- returns_EUR[i:(i+35),]
rf_period <- RF.EU$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix2[i,] <- 0
} else{
w_matrix2[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df2 <- as_tibble(w_matrix2)
names(w_df2) <- names(returns_EUR[, -1])
round(w_df2, 3)
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
n <- nrow(size_mom_6_monthly)-35
w_matrix <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35), -1]
rf_period <- RF.US$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix[i,] <- 0
} else{
w_matrix[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df <- as_tibble(w_matrix)
names(w_df) <- names(size_mom_6_monthly[, -1])
round(w_df, 3)
size_mom_6_monthly <- size_mom_6$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
RF.EU <- RF.US # skal ændres til EU
returns_EUR <- sweep(size_mom_6_monthly[,-1], 1, Exchange_rate_US$USD, "/")
n <- nrow(returns_EUR)-35
w_matrix2 <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- returns_EUR[i:(i+35),]
rf_period <- RF.EU$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix2[i,] <- 0
} else{
w_matrix2[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df2 <- as_tibble(w_matrix2)
names(w_df2) <- names(returns_EUR[, -1])
round(w_df2, 3)
size_mom_6_monthly <- size_mom_6_euro$subsets$data[[1]] %>% filter(date >= 200409)
RF.US <- ff_3_factors$subsets$data[[1]] %>% filter(date >= 200409) %>%
select(c("date", "RF"))
RF.EU <- RF.US # skal ændres til EU
n <- nrow(size_mom_6_monthly)-35
w_matrix3 <- matrix(NA, nrow = n, ncol = 6)
for(i in 1:n){
returns_period <- size_mom_6_monthly[i:(i+35),-1]
rf_period <- RF.EU$RF[i:(i+35)]
mu <- colMeans(returns_period) - mean(rf_period)
cov_period <- cov(returns_period)
if(all(mu <= 0)){
w_matrix3[i,] <- 0
} else{
w_matrix3[i,] <- optimize_portfolio(mu, cov_period)
}
}
w_df3 <- as_tibble(w_matrix3)
names(w_df3) <- names(size_mom_6_monthly[, -1])
round(w_df3, 3)
